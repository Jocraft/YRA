{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{% trans "Learning Methods" %} | {% trans "Youth Road Analyzer" %}{% endblock title %}

{% block extra_css %}
<!-- (Optional) If you wish to style the selects or use Select2, include its CSS here. -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

<style>
  /* Basic styling similar to your Path Finding example */
  .select2-container--bootstrap-5 .select2-selection {
    min-height: 38px;
  }
  .select2-container--bootstrap-5 .select2-selection--single {
    padding: 0.375rem 2.25rem 0.375rem 0.75rem;
  }
  .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered {
    padding: 0;
    line-height: 1.5;
  }
  .form-select {
    width: auto; /* Adjusts width based on content */
    min-width: 200px; /* Optional: Sets a minimum width */
    white-space: nowrap; /* Prevents wrapping */
  }

  .btn-secondary {
    white-space: nowrap; /* Prevents wrapping for buttons */
  }
</style>
{% endblock extra_css %}

{% block content %}
<!-- BREADCRUMB -->
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
    <li class="breadcrumb-item active" aria-current="page">{% trans 'Learning Methods' %}</li>
  </ol>
</nav>

<h1 class="title-1 mb-4">{% trans "Learning Methods" %}</h1>

<!-- Row for "Select Student" + "Select Group Count" + "Bulk Upload" -->
<div class="row g-3 align-items-center mb-3">
  <div class="col-auto">
    <form method="get" action="" class="mb-0 ">
      <!-- Student dropdown -->
      <label for="student" class="col-form-label fw-bold me-2">
        {% trans "Select Student" %}:
      </label>
      <select
        name="student"
        id="student"
        class="form-select me-3"
        onchange="this.form.submit()"
      >
        <option value="">{% trans "—" %}</option>
        {% for st in students %}
          <option
            value="{{ st.id }}"
            {% if selected_student and selected_student.id == st.id %}selected{% endif %}
          >
            {{ st }}
          </option>
        {% endfor %}
      </select>

      <!-- Group Count dropdown -->
      <label for="group_count" class="col-form-label fw-bold me-2">
        {% trans "Learning Style Groups" %}:
      </label>
      <select
        name="group_count"
        id="group_count"
        class="form-select me-3"
        onchange="this.form.submit()"
      >
        <option value="4" {% if group_count == '4' %}selected{% endif %}>4 Groups (VARK)</option>
        <option value="3" {% if group_count == '3' %}selected{% endif %}>3 Groups (VA-RK-Special)</option>
        <option value="2" {% if group_count == '2' %}selected{% endif %}>2 Groups (VA-RK)</option>
      </select>

      <!-- If NO student is selected, show "Bulk Upload" in the same row -->
      {% if not selected_student %}
        <a href="{% url 'learning_methods:bulk_upload' %}" class="btn btn-secondary">
          <i class="fas fa-upload"></i> {% trans "Bulk Upload" %}
        </a>
      {% endif %}
    </form>
  </div>
</div>

<!-- If a student is selected, automatically show their info (like in “screen 2”) -->
{% if selected_student %}
  <div class="row g-3 align-items-center">
    <div class="col-auto">
      <h4 class="mb-0">
        {% trans "Selected Student" %}:
        <span class="text-warning">{{ selected_student }}</span>,
        ID: <span class="text-warning">{{ student_id }}</span>
      </h4>
    </div>
    <div class="col-auto d-flex align-items-center">
      {% if latest_test %}
        <span class="text-info me-3 d-flex align-items-center">
          <i class="fas fa-check-circle me-1"></i>
          {% trans "Last test taken on" %}:
          {{ latest_test.date_taken|date:"F d, Y H:i" }}
        </span>
        <a href="{% url 'learning_methods:fill_test' selected_student.id %}" class="btn btn-primary me-2">
          <i class="fas fa-redo-alt"></i> {% trans "Retake Test" %}
        </a>
        <a href="{% url 'learning_methods:results' selected_student.id %}?group_count={{ group_count }}" class="btn btn-success">
          <i class="fas fa-chart-bar"></i> {% trans "View Results" %}
        </a>
      {% else %}
        <span class="text-warning me-3 d-flex align-items-center">
          <i class="fas fa-exclamation-circle me-1"></i>
          {% trans "This student has not taken the learning style test yet." %}
        </span>
        <a href="{% url 'learning_methods:fill_test' selected_student.id %}" class="btn btn-primary">
          <i class="fas fa-play-circle"></i> {% trans "Take Test" %}
        </a>
      {% endif %}
    </div>
  </div>
{% endif %}
{% endblock content %}

{% block extra_js %}
<!-- (Optional) If you want Select2 for search, you can enable it here. -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
  // If you'd like the fancy Select2 dropdown (not strictly required):
  $(document).ready(function() {
    $('#student').select2({
      theme: 'bootstrap-5',
      placeholder: "{% trans 'Type to search for a student...' %}",
      allowClear: true,
      width: '100%',
    });
  });
</script>
{% endblock extra_js %}
